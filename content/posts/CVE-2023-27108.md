+++
title = "CVE-2023-27108: Call Logs in the Browser"
description = "CVE-2023-27108: Accessing Call Logs from the Browser on KaiOS 3.0 & 3.1"
date = 2023-05-02T00:00:00+08:00
lastmod = 2023-05-02T00:00:00+08:00
toc = true
draft = false
header_img = "img/home-alt.png"
tags = ["KaiOS", "Security", "CVE-2023-27108"]
categories = []
series = ["Advanced Development"]
+++

[CVE-2023-27108](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-27108) was published today, outlining a vulnerability in KaiOS 3.0 & 3.1 exposing call logs without user interaction to apps and websites.

![Photo of call logs exposed in Nokia 2780 Flip browser (Credit: @sosumi1984)](/img/CVE-2023-27108.jpg "Photo of call logs exposed in Nokia 2780 Flip browser (Credit: <a href='https://github.com/sosumi1984' rel='external noopener'>@sosumi1984</a>)")

**Why it matters?** KaiOS 3.0 & 3.1 users in the US may be inadvertently exposing their call log records simply by visiting a web page.

## Background

KaiOS 3.0 was released in [September 2021](https://www.phonearena.com/news/tcl-flip-pro-and-alcatel-go-flip4-release-price_id135116) with the Alcatel Go Flip 4 and TCL Flip Pro. It is the successor to KaiOS 2.5 and to date is only available in the United States. Although developers can publish applications for KaiOS 3.0, at the time of writing, no hardware device shipped with DevTools enabled nor have hackers gained root access. In November 2022, the [Nokia 2780 Flip](https://screenrant.com/hmd-global-nokia-2780-flip-reveal/) was released, and since it was SIM unlocked, KaiOS developers hoped that like prior Nokia devices, it would be developer-friendly.

@Farooq and @Affe Null of the KaiOS Discord were able to extract the [system image](https://farooqkz.de1.hashbang.sh/) from the Nokia 2780 Flip, WND (HWID 0). The system image includes the JavaScript that powers the Boot2Gecko system. Developers hoped this would lead to the discovery of [secret debug codes](https://www.youtube.com/watch?v=lNwKGCBRy-A). This was not the case, but in the process, other features and vulnerabilities were uncovered.

## CVE-2023-27108: Technical details

In February 2023, I discovered that the pre-installed system Communications app on KaiOS 3.0 (source: `/system/b2g/webapps/communications/`) declared in it's `manifest.webmanifest` a [Web Activity]({{< ref "./web-activities" >}}) for retrieving the user's call logs.

```json
"getCallLogList": {
    "filters": {
        "type": {
            "required": true,
            "value": [
                "calllog/tel"
            ]
        }
    },
    "returnValue": true
}
```

In KaiOS 3.0, Web Activities are handled by Service Workers. Here is a simplified example of how this activity is handled within the `serviceWorker.js` script in the Communication app.

```js
self.onsystemmessage = (evt) => {
  evt.waitUntil(
    (() => {
      switch (evt.name) {
        case 'activity':
          const handler = evt.data.webActivityRequestHandler();

          if (handler.source.name === 'getCallLogList') {
            db.getAllData()
              .then(list => {
                handler.postResult(list);
              })
              .catch(() => {
                handler.postResult([]);
              });
          }

          break;
    })()
  );
};
```

The Service Worker calls the method `getAllData` from a wrapper class that returns the call log data stored in IndexedDB. Because there are no permission checks, nor is the `allowedOrigins` property set in `manifest.webmanifest`, **call log data is returned to any caller**. This means that any app or website you visit can access call log data without user interaction.

### How It Works

Any app or website executing JavaScript can instantiate a `WebActivity` in KaiOS 3.0. The `start` method returns a `Promise` that resolves to an `Array` of objects containing call log data.

```js
let activity = new WebActivity("getCallLogList", {
    type: "calllog/tel",
});
activity.start()
    .then((callLogList) => {
        // @param { String } number - tel number
        // @param { String } date - call time
        // @param { String } callType - call in/out/miss
        // @param { String } duration
    });
```

It's this simplicity and lack of user interaction that makes this exploit especially dangerous. Simply using an app or visiting a web page is enough for a malicious actor to access your call logs, which can subsequently be sent to a remote server via `XMLHttpRequest` or `fetch`.

### Recommended Mitigation

`getCallLogList` appears to be used by the System app to display a phone book to the user. The easiest solution would be to set the `allowedOrigins` property within the Communication app's `manifest.webmanifest` file to only allow the System app to call this activity.

```json
"datastores-owned": {
    "calllog": { }
}
```

Additionally, these data are made available via the Data Store API. Rather than expose call logs via a Web Activity, they should be accessed using Data Stores which is only available within Certified apps. In the rare case of Certified apps uploaded to the KaiStore, KaiOS can check the `datastores-access` property in their manifest to confirm that they do not access call logs needlessly.

## Is KaiOS Secure?

To date, KaiOS only has [6 published CVEs](https://www.cvedetails.com/product/52574/Kaiostech-Kaios.html?vendor_id=19715), plus this one. Compared to [Android's 5,121+ CVEs](https://www.cvedetails.com/product/19997/Google-Android.html?vendor_id=1224), it sounds like KaiOS is more secure, right? Well the answer is more complicated.

Android has been around since 2010, is shipped on tens of thousands of devices, and used by billions as smartphones, tablets, and car infotainment (Android Auto). KaiOS was first released in 2017 and is available on [under 200 devices](https://kaios.app/). Unfortunately, many KaiOS devices stop receiving over the air (OTA) updates, including security updates, just one year after release. While many budget Android OEMs offer similarly poor support, the Google Pixel devices now come with _at least_ [5 years of security updates](https://support.google.com/pixelphone/answer/4457705). Further up market, Apple sometimes provides critical security updates more than [10 years after initial release](https://www.makeuseof.com/apple-security-updates-for-10-year-old-devices/).

There is no single measure of digital security, and no easy way to compare security profiles across different systems. Due to limited app availability and platform restrictions, you are probably not accessing a bank account or sharing credit cards via a digital NFC wallet on KaiOS feature phones. Nonetheless, always consider privacy, security, and usability when purchasing a phone for daily use.
